;; https://jtroo.github.io/config.html

;; Global configuration, this configuration applied globally
(defcfg
  process-unmapped-keys yes
  concurrent-tap-hold yes ;; for input chording/combos
  danger-enable-cmd yes

;; uncomment this code below if you using kanata in macos, to prevent bugs that causing kanata doesn't work after sleep

;;  macos-dev-names-exclude (
;;    "Corne"
;;    "kbdksp/geulisv1"
;;  )

;;  macos-dev-names-include (
;;      "Chian's Magic Keyboard"
;;  )

)

;; Variable for storing a constant value
(defvar
  tap-time 200
  hold-time 200
  hold-time-slow 300
  input-chord-time 250
)

;; Define key that want to remap
(defsrc
       f1    f2    f3    f4    f5    f6    f7    f8    f9    f10   f11   f12
  grv  1    2    3    4    5    6    7    8    9    0    -    =    bspc
  tab  q    w    e    r    t    y    u    i    o    p    [    ]    \
  caps a    s    d    f    g    h    j    k    l    ;    '    ret
  lsft z    x    c    v    b    n    m    ,    .    /    rsft
  lctl lmet lalt           spc            ralt rmet rctl
)

;;  Syntax for tap-hold
;;  (tap-hold TAP-TIME HOLD-TIME TAP-KEY HOLD-KEY)
(defalias
  cw (caps-word 1000)

  ;; ==== LAYERS ====
  ;; You may also use `layer-toggle` in place of `layer-while-held`; they behave exactly the same. The `layer-toggle` name is slightly shorter but is a bit inaccurate with regards to its meaning.
  lwh_nums (layer-while-held nums)
  lwh_symbols (layer-while-held symbols)
  lwh_tmux (layer-while-held tmux)
  lwh_nav  (layer-while-held nav)
  lwh_sublayers (layer-while-held sublayers)

  smcol (tap-hold $tap-time $hold-time ; @lwh_nums)
  spc_ly3 (tap-hold $tap-time $hold-time spc @lwh_symbols)
  caps (tap-hold $tap-time $hold-time esc @lwh_nav)
  rtn (tap-hold $tap-time $hold-time ret @lwh_sublayers)
  slash (tap-hold $tap-time $hold-time / @lwh_tmux)
  z (tap-hold $tap-time $hold-time z @lwh_tmux)

  {{ if eq .chezmoi.os "darwin" -}}
  lmet_tab (tap-hold $tap-time $hold-time tab M-tab)
  {{- else if eq .chezmoi.os "linux" }}
  lmet_tab (tap-hold $tap-time $hold-time tab A-tab )
  {{- end }}

  ;; ==== MODIFIER KEYS + LETTER KEYS ====
  s (tap-hold $tap-time $hold-time s lctl)
  d (tap-hold $tap-time $hold-time d lalt)
  f (tap-hold $tap-time $hold-time f lmet)
  l (tap-hold $tap-time $hold-time l lctl)
  k (tap-hold $tap-time $hold-time k lalt)
  j (tap-hold $tap-time $hold-time j lmet)
  {{ if eq .chezmoi.os "darwin" -}}
  m (tap-hold $tap-time $hold-time m rmet)
  v (tap-hold $tap-time $hold-time v rmet)
  {{- else if eq .chezmoi.os "linux" }}
  m (tap-hold $tap-time $hold-time m lmet)
  v (tap-hold $tap-time $hold-time v lmet)
  {{- end }}
  hyperkey (tap-hold $tap-time $hold-time spc (multi lsft lctl lalt lmet))

  ;; ==== OS SPECIFIC ====
  ;; - macOS -
  mc C-up ;; Mission Control
  sls M-spc ;; Spotlight Search
  dtn S-C-A-M-f5 ;; Dictation
  dnd S-C-A-M-f6 ;; Do Not Disturb
  lp S-C-A-M-l ;; Launchpad

  sprwhpr C-A-/ ;; Superwhisper
  hmrwapp M-S-spc

  tab-left C-S-tab
  tab-right C-tab
)

;; == Input combos / chording ==
#|
  syntax:
  (participating-keysN) actionN timeoutN release-behaviourN (disabled-layersN)

  references:
  https://jtroo.github.io/config.html#input-chords-v2

  timeoutN :
  The maximum time (in milliseconds) between the first key press and the subsequent ones for them to be recognized as a "chord".
  If the keys are not pressed within this time window, the system treats them as regular key presses (not a chord) and processes them according to the active layer.
|#

(defchordsv2
  {{- if eq .chezmoi.os "darwin" }}
  (m ,) A-bspc $input-chord-time all-released ()
  (i o) A-left 20 all-released ()
  (o p) A-right 20 all-released ()

  {{- else if eq .chezmoi.os "linux" }}
  (m ,) C-bspc $input-chord-time all-released ()
  (i o) C-left 20 all-released ()
  (o p) C-right 20 all-released ()
  (lalt lsft [) C-S-tab 250 first-release ()
  (lalt lsft ]) C-tab 250 first-release ()
  {{- end }}

  (l =) lrld $input-chord-time all-released () ;; live reload kanata, press this after changing kanata configuration
)

;; == Layers ==
;; the order of deflayer is important, the first layer defined is the layer that will be active by default when kanata is running

;; Define base / default layer
(deflayer base
       🔅    🔆    @mc   @sls  @dtn  @dnd  ◀◀    ▶⏸    ▶▶    🔇    🔉    🔊
  grv  1    2    3    4    5    6    7    8    9    0    -    =    bspc
  @lmet_tab    q    w    e    r    t    y    u    i    o    p    [    ]    \
  @caps  a    @s    @d    @f    g    h    @j    @k    @l    @smcol    '    @rtn
  lsft @z    x    c    @v    b    n    @m    ,    .   @slash    rsft ;; Tombol x sekarang punya fungsi ganda
  lctl lmet lalt           @spc_ly3            ralt rmet rctl
)

(deflayer nav
       🔅    🔆    @mc   @sls  @dtn  @dnd  ◀◀    ▶⏸    ▶▶    🔇    🔉    🔊
  grv  1    2    3    4    5    6    7    8    9    0    -    =    bspc
  tab  f1   f2   f3   f4   f5    f6    f7    f8    f9    f10    @tab-left   @tab-right    \
  caps a    @sprwhpr    @hmrwapp    f    g    left    down    up    right    ;    '    ret
  lsft z    x    c    v    b    n    rctl    ,    .    rmet    rsft
  lctl lmet lalt           @hyperkey            ralt rmet rctl
)

(deflayer nums
       🔅    🔆    @mc   @sls  @dtn  @dnd  ◀◀    ▶⏸    ▶▶    🔇    🔉    🔊
  grv  XX    XX    XX    XX    XX    XX    XX    XX    XX    XX    -    =    bspc
  tab  f1   f2   f3   f4   f5    f6    f7    f8    f9    f10    @tab-left   @tab-right    \
  caps 1    2    3    4    5    6    7    8    9    ;    '    ret
  lsft XX  XX  XX  XX  XX    XX    0    ,    .    /    rsft
  lctl lmet lalt           spc            ralt rmet rctl
)

(deflayer symbols
       🔅    🔆    @mc   @sls  @dtn  @dnd  ◀◀    ▶⏸    ▶▶    🔇    🔉    🔊
  grv  1    2    3    4    5    6    7    8    9    0    -    =    bspc
  tab  XX   -   =   XX   XX   XX   XX   XX   XX   XX  @tab-left   @tab-right    \
  caps S-1  S-2  S-3  S-4  S-5    S-6    S-7    S-8    S-9    S-0    '    ret
  lsft 1    2    3    4    5    6    7    8    9    0    rsft
  lctl lmet lalt           spc            ralt rmet rctl
)

(defalias
  {{ if eq .chezmoi.os "darwin" }}
  ly-rayc (tap-hold $tap-time $hold-time r (layer-while-held raycast))
  {{ else if eq .chezmoi.os "linux" }}
  ly-rayc r
  {{- end }}
)

(deflayer sublayers
       🔅    🔆    @mc   @sls  @dtn  @dnd  ◀◀    ▶⏸    ▶▶    🔇    🔉    🔊
  grv  o   XX   XX    XX   XX   XX   XX   XX   XX   XX   XX   XX   XX
  tab  XX   XX   XX   @ly-rayc   XX   XX   XX   XX   XX   XX   XX   XX   XX
  caps XX   XX   XX   XX   XX   XX   XX   XX   XX   XX   XX   XX
  lsft XX   XX   XX   XX   XX   XX   XX   XX   XX   XX   XX
  lctl lmet lalt           spc            ralt rmet rctl
)

;; == TMUX ==
(defalias
  tmux-prefix C-a

  tx-new-window (macro @tmux-prefix c) ;; new window
  tx-rn-window (macro @tmux-prefix ,) ;; rename window
  tx-plg-sesh  (macro @tmux-prefix o) ;; sesh plugin

  ;; switch between last session/window/pane
  tx-sw-session (macro @tmux-prefix S-a)
  tx-sw-window (macro @tmux-prefix a)
  tx-sw-pane (macro @tmux-prefix q)

  ;; split pane
  tx-splith (macro @tmux-prefix -)
  tx-splitv (macro @tmux-prefix S-\)

  ;; select session/window
  tx-slcsession (macro @tmux-prefix s)
  tx-slcwindow (macro @tmux-prefix w)

  ;; kill window/pane
  tx-kill-window (macro @tmux-prefix S-7)
  tx-kill-pane (macro @tmux-prefix x)

  ;; switch window to {number}
  tx-wdw-1 (macro @tmux-prefix Digit1)
  tx-wdw-2 (macro @tmux-prefix Digit2)
  tx-wdw-3 (macro @tmux-prefix Digit3)
  tx-wdw-4 (macro @tmux-prefix Digit4)
  tx-wdw-5 (macro @tmux-prefix Digit5)

  ;; pane navigation
  tx-p-left (macro @tmux-prefix h)
  tx-p-bottom (macro @tmux-prefix j)
  tx-p-top (macro @tmux-prefix k)
  tx-p-right (macro @tmux-prefix l)
)

(deflayer tmux
       🔅        🔆        @mc            @sls           @dtn           @dnd           ◀◀        ▶⏸          ▶▶                    🔇            🔉            🔊
  grv  @tx-wdw-1          @tx-wdw-2       @tx-wdw-3      @tx-wdw-4      @tx-wdw-5      6         7           8                     9             0             @tx-splith         @tx-splitv         bspc
  tab  @tx-slcsession     @tx-slcwindow   f3             XX             f5             f6        f7          f8                    @tx-plg-sesh  XX            XX                 XX                \
  caps @tx-sw-session     @tx-sw-window   @tx-sw-pane    4              5              @tx-p-left  @tx-p-bottom          @tx-p-top     @tx-p-right   ;      '                  ret
  lsft @tx-kill-window    @tx-kill-pane   @tx-new-window XX             0              XX        @cw         @tx-rn-window         .             /             rsft
  lctl lmet               lalt                             spc                                            ralt            rmet              rctl
)

{{ if eq .chezmoi.os "darwin" -}}
;; == RAYCAST ==
(defalias
  rrain (cmd open "raycast://extensions/lardissone/raindrop-io/search")
  remoj (cmd open "raycast://extensions/raycast/emoji-symbols/search-emoji-symbols")
  rspot (cmd open "raycast://extensions/mattisssa/spotify-player/search")
  ryout (cmd open "raycast://extensions/tonka3000/youtube/search-videos?arguments=%7B%22query%22%3A%22%22%7D")
)

(deflayer raycast
       🔅    🔆    @mc   @sls  @dtn  @dnd  ◀◀    ▶⏸    ▶▶    🔇    🔉    🔊
  grv  XX   XX   XX   XX   XX   XX   XX   XX   XX   XX   XX   XX   XX
  tab  XX   XX   @remoj   XX   XX   XX   XX   XX   XX   XX   XX   XX   XX
  caps XX   XX   XX   XX   XX   XX   @rspot   @rrain   @ryout   XX   XX   XX
  lsft XX   XX   XX   XX   XX   XX   XX   XX   XX   XX   XX
  lctl lmet lalt           spc            ralt rmet rctl
)
{{ end }}
