{{- if eq .chezmoi.os "linux" -}}
PATH="${HOME}/.atuin/bin/:${PATH}"
{{- end }}

if (( $+commands[atuin] )); then
    if [[ -n ${ZSH_NAME} ]]; then
        _init_atuin_zsh() {
            export ATUIN_NOBIND="true"
            eval "$(atuin init zsh)"
            bindkey '^[[A' atuin-up-search
            bindkey '^[OA' atuin-up-search
            (( $+widgets[_atuin_search_widget] )) && bindkey '^r' _atuin_search_widget
        }

        if (( $+functions[zsh-defer] )); then
            zsh-defer _init_atuin_zsh
        else
            _init_atuin_zsh
        fi
    elif [[ -n ${BASH} ]]; then
        # shellcheck disable=SC1091
        [[ -f ~/.bash-preexec.sh ]] && source "${HOME}/.bash-preexec.sh"
        eval "$(atuin init bash)"
        bind -x '"\C-r": __atuin_history'
        bind -x '"\e[A": __atuin_history --shell-up-key-binding'
        bind -x '"\eOA": __atuin_history --shell-up-key-binding'
    fi
fi
