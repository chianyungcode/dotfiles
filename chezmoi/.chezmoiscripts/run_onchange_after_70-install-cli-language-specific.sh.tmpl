#!/usr/bin/env bash
{{ if .dev_computer }}
set -euo pipefail

{{ template "shared_script_utils.bash" . }}

header "Installing language-specific CLI tooling"

install_npm_global() {
    local package="$1"
    if npm list -g --depth=0 "$package" >/dev/null 2>&1; then
        info "npm package '$package' already installed globally"
    else
        info "Installing npm package '$package'"
        npm install -g "$package"
        success "npm package '$package' installed"
    fi
}

install_cargo_crate() {
    local crate="$1"
    shift
    if cargo install --list | grep -q "^${crate} v"; then
        info "cargo crate '$crate' already installed"
    else
        info "Installing cargo crate '$crate'"
        cargo install "$crate" "$@"
        success "cargo crate '$crate' installed"
    fi
}

if command -v npm >/dev/null 2>&1; then
    install_npm_global opencommit
    install_npm_global @openai/codex
else
    warning "npm not found; skipping npm CLI installation"
fi

if command -v cargo >/dev/null 2>&1; then
    install_cargo_crate kanata --locked
    install_cargo_crate cargo-seek --locked
else
    warning "cargo not found; skipping Rust CLI installation"
fi

success "Finished installing language-specific CLI tooling"
_safeExit_ 0
{{- end }}
