{{- if and (eq .chezmoi.os "linux") (eq .chezmoi.osRelease.id "arch") -}}

#!/usr/bin/env bash

{{ template "shared_script_utils.bash" . }}

packages=(
    {{ range $package := .packages.pacman.common.cli }}
    "{{ $package }}"
    {{ end }}
    {{ range $package := .packages.pacman.common.apps }}
    "{{ $package }}"
    {{ end }}
    {{ if .dev_computer }}
    {{ range $package := .packages.pacman.dev_computer.cli }}
    "{{ $package }}"
    {{ end }}
    {{ range $package := .packages.pacman.dev_computer.apps }}
    "{{ $package }}"
    {{ end }}
    {{ end }}
    {{ if .homelab_member }}
    {{ range $package := .packages.pacman.homelab_member.cli }}
    "{{ $package }}"
    {{ end }}
    {{ range $package := .packages.pacman.homelab_member.apps }}
    "{{ $package }}"
    {{ end }}
    {{ end }}
    {{ if .personal_computer }}
    {{ range $package := .packages.pacman.personal_computer.cli }}
    "{{ $package }}"
    {{ end }}
    {{ range $package := .packages.pacman.personal_computer.apps }}
    "{{ $package }}"
    {{ end }}
    {{ end }}
)

header "Installing packages with paru"
paru -Syu --noconfirm

for package in "${packages[@]}"; do
    if paru -Qi "${package}" &>/dev/null; then
        info "Package ${package} is already installed"
        continue
    fi
    if paru -Ss "^${package}$" &>/dev/null; then
        paru -S --noconfirm "${package}"
    else
        warning "Package ${package} is not available"
    fi
done

success "Paru packages installed"
_safeExit_

{{- end }}
